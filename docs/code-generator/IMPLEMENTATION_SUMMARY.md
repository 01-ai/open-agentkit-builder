# ä»£ç ç”Ÿæˆå™¨å®ç°æ€»ç»“

**å®Œæˆæ—¥æœŸ**: 2025-10-20
**æœ€åæ›´æ–°**: æäº¤ `2e223b8`

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº† Open Agent Builder ä»£ç ç”Ÿæˆå™¨åœ¨æœ¬é˜¶æ®µçš„å®ç°å·¥ä½œï¼Œé‡ç‚¹å…³æ³¨ Agentã€FileSearchã€Guardrails ç­‰èŠ‚ç‚¹ç±»å‹çš„ä»£ç ç”ŸæˆåŠŸèƒ½ã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

å®ç°ä»å¯è§†åŒ–å·¥ä½œæµé…ç½®åˆ°å¯æ‰§è¡Œ Python SDK ä»£ç çš„è½¬æ¢ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… Agent èŠ‚ç‚¹çš„æ™ºèƒ½å˜é‡å‘½å
2. âœ… FileSearch èŠ‚ç‚¹çš„å¤šå®ä¾‹æ”¯æŒ
3. âœ… Guardrails èŠ‚ç‚¹çš„å¤šå±‚çº§åˆ†æ”¯å¤„ç†
4. âœ… å¤æ‚å·¥ä½œæµçš„å®Œæ•´ä»£ç ç”Ÿæˆ

## ğŸ“Š å®Œæˆå·¥ä½œç»Ÿè®¡

### ä»£ç ç”Ÿæˆå™¨æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½                | çŠ¶æ€    | æµ‹è¯•è¦†ç›– |
| ------------------- | ------- | -------- |
| Agent èŠ‚ç‚¹ç”Ÿæˆ      | âœ… å®Œæˆ | 12+ æµ‹è¯• |
| FileSearch èŠ‚ç‚¹ç”Ÿæˆ | âœ… å®Œæˆ | 4+ æµ‹è¯•  |
| Guardrails èŠ‚ç‚¹ç”Ÿæˆ | âœ… å®Œæˆ | 8+ æµ‹è¯•  |
| å¤šèŠ‚ç‚¹å·¥ä½œæµæ”¯æŒ    | âœ… å®Œæˆ | å·²éªŒè¯   |
| å·¥ä½œæµåˆ†æ”¯å¤„ç†      | âœ… å®Œæˆ | å·²éªŒè¯   |
| é”™è¯¯å¤„ç†            | âœ… å®Œæˆ | å·²éªŒè¯   |

### æµ‹è¯•ç»“æœ

```
Test Files:  2 passed (2)
Tests:       52 passed (52)
Coverage:    æ‰€æœ‰ä»£ç ç”Ÿæˆå™¨åŠŸèƒ½
Success Rate: 100%
```

## ğŸ”§ å…³é”®å®ç°è¯¦æƒ…

### 1. Agent èŠ‚ç‚¹å˜é‡å‘½å

**é—®é¢˜**: å¤šä¸ª Agent èŠ‚ç‚¹éœ€è¦å”¯ä¸€çš„å˜é‡åï¼Œä¸”è¦å¤„ç†é»˜è®¤æ ‡ç­¾å†²çª

**è§£å†³æ–¹æ¡ˆ**:

- å®ç° `generateAgentVarName()` å‡½æ•°
- è§„åˆ™ï¼š
  - é»˜è®¤æ ‡ç­¾ "Agent"ï¼š`agent`, `agent1`, `agent2`, ...
  - è‡ªå®šä¹‰æ ‡ç­¾ï¼šè½¬æ¢ä¸º snake_case
  - æ™ºèƒ½è·³è¿‡è¢«å ç”¨çš„æ•°å­—

**å®ç°æ–‡ä»¶**: `lib/code-generator.ts`

**ç¤ºä¾‹**:

```python
# å·¥ä½œæµï¼šAgent(é»˜è®¤), Agent2(è‡ªå®šä¹‰), Agent(é»˜è®¤), Agent(é»˜è®¤)
agent = Agent(...)           # ç¬¬ä¸€ä¸ªé»˜è®¤
agent2 = Agent(...)          # è‡ªå®šä¹‰
agent1 = Agent(...)          # è·³è¿‡agent2ï¼Œä½¿ç”¨agent1
agent3 = Agent(...)          # ç»§ç»­
```

### 2. FileSearch èŠ‚ç‚¹å¤šå®ä¾‹æ”¯æŒ

**é—®é¢˜**: å¤šä¸ª FileSearch èŠ‚ç‚¹éœ€è¦ä¸åŒçš„å˜é‡åå’Œæ­£ç¡®çš„å¼•å·è½¬ä¹‰

**è§£å†³æ–¹æ¡ˆ**:

- æ·»åŠ  `fileSearchIndex` å‚æ•°ç”¨äºç´¢å¼•
- ç”Ÿæˆ `filesearch_result`, `filesearch_result1`, `filesearch_result2` ç­‰
- æ­£ç¡®è½¬ä¹‰æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„å¼•å·

**å®ç°æ–‡ä»¶**: `lib/generators/nodes/file-search-node.ts`

**ç¤ºä¾‹**:

```python
filesearch_result = await client.beta.files.retrieve_file_search_result(...)
filesearch_result1 = await client.beta.files.retrieve_file_search_result(...)
```

### 3. Guardrails èŠ‚ç‚¹å¤šå±‚çº§åˆ†æ”¯å¤„ç†

**é—®é¢˜**: å¤šä¸ªè¿ç»­çš„ Guardrails èŠ‚ç‚¹éœ€è¦ï¼š

- åµŒå¥—çš„ if/else åˆ†æ”¯
- æ­£ç¡®çš„ç¼©è¿›é€’å¢
- æ­£ç¡®çš„è¾“å…¥è¡¨è¾¾å¼é“¾æ¥ï¼ˆå‰ä¸€ä¸ªèŠ‚ç‚¹çš„ç»“æœ â†’ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å…¥ï¼‰

**è§£å†³æ–¹æ¡ˆ**:

#### 3.1 è¾“å…¥è¡¨è¾¾å¼å¤„ç†

- ç¬¬ä¸€ä¸ª Guardrails èŠ‚ç‚¹ï¼šä½¿ç”¨é…ç½®çš„è¡¨è¾¾å¼ï¼ˆå¦‚ `workflow["input_as_text"]`ï¼‰
- åç»­èŠ‚ç‚¹ï¼šè‡ªåŠ¨ä½¿ç”¨å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ç»“æœ `guardrails_result[previous_index]["safe_text"]`
- åœ¨ `generateGuardrailsNodeCode()` ä¸­æ·»åŠ  `previousGuardrailsResultVar` å‚æ•°

#### 3.2 ç¼©è¿›è®¡ç®—

- å…¬å¼ï¼š`indent = 2 + guardrailsIndex * 2`
- guardrailsIndex 0: 2 spaces (é¡¶å±‚)
- gardrailsIndex 1: 4 spaces (ç¬¬ä¸€å±‚åµŒå¥—)
- gardrailsIndex 2: 6 spaces (ç¬¬äºŒå±‚åµŒå¥—)
- gardrailsIndex 3+: 8+ spaces (æ›´æ·±å±‚åµŒå¥—)

#### 3.3 åˆ†æ”¯æ„é€ 

```python
# ç¬¬ä¸€ä¸ª Guardrails
guardrails_inputtext = workflow["input_as_text"]
guardrails_result = await run_guardrails(...)
if guardrails_hastripwire:
  return guardrails_output
else:
  # ç¬¬äºŒä¸ª Guardrailsï¼ˆåµŒå¥—åœ¨elseä¸­ï¼‰
  guardrails_inputtext1 = guardrails_result["safe_text"]  # è¾“å…¥æ¥è‡ªå‰ä¸€ä¸ª
  guardrails_result1 = await run_guardrails(...)
  if guardrails_hastripwire1:
    return guardrails_output1
  else:
    # ç¬¬ä¸‰ä¸ª Guardrailsï¼ˆæ›´æ·±å±‚åµŒå¥—ï¼‰
    ...
```

**å®ç°æ–‡ä»¶**:

- `lib/generators/nodes/guardrails-node.ts` - èŠ‚ç‚¹ä»£ç ç”Ÿæˆ
- `lib/code-generator.ts` - å¤šèŠ‚ç‚¹åˆ†æ”¯å¤„ç†é€»è¾‘

### 4. å¯¹è¯å†å²ç®¡ç†

**è§„åˆ™**: `conversation_history.extend()` åœ¨ä»¥ä¸‹æ¡ä»¶è§¦å‘ï¼š

- å½“å‰ Agent åé¢è¿˜æœ‰å…¶ä»– Agent èŠ‚ç‚¹ï¼Œ**æˆ–**
- è¿™æ˜¯å•ä¸ª Agent å·¥ä½œæµï¼Œ**æˆ–**
- å·¥ä½œæµä¸­æœ‰ End èŠ‚ç‚¹

**å®ç°**:

```typescript
if (hasNextAgentNode || totalAgentNodes === 1 || hasEndNode) {
  conversation_history.extend(...)
}
```

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ ¸å¿ƒç”Ÿæˆå™¨æ–‡ä»¶

```
lib/
â”œâ”€â”€ code-generator.ts                    # ä¸»ç”Ÿæˆå™¨é€»è¾‘
â”œâ”€â”€ generators/
â”‚   â””â”€â”€ nodes/
â”‚       â”œâ”€â”€ agent-node.ts               # Agent èŠ‚ç‚¹ç”Ÿæˆ
â”‚       â”œâ”€â”€ file-search-node.ts         # FileSearch èŠ‚ç‚¹ç”Ÿæˆ
â”‚       â”œâ”€â”€ guardrails-node.ts          # Guardrails èŠ‚ç‚¹ç”Ÿæˆ
â”‚       â””â”€â”€ ...å…¶ä»–èŠ‚ç‚¹ç±»å‹
```

### æµ‹è¯•è¦†ç›–

```
tests/code-generator/
â”œâ”€â”€ core_nodes/
â”‚   â””â”€â”€ agent/
â”‚       â”œâ”€â”€ agent_with_newlines/
â”‚       â”œâ”€â”€ multiple_agents/
â”‚       â”œâ”€â”€ multiple_agents_default_labels/
â”‚       â”œâ”€â”€ multiple_agents_mixed_labels/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ tool_nodes/
â”‚   â”œâ”€â”€ file_search/
â”‚   â”‚   â””â”€â”€ multiple_file_search/
â”‚   â””â”€â”€ guardrails/
â”‚       â”œâ”€â”€ guardrails_with_name_and_input/
â”‚       â””â”€â”€ guardrails_with_multiple_and_labels/
```

## ğŸš€ ä¸»è¦æ”¹è¿›ç‚¹

### 1. æ™ºèƒ½å˜é‡å‘½åç³»ç»Ÿ

- é¿å…å˜é‡åå†²çª
- æ”¯æŒè‡ªå®šä¹‰æ ‡ç­¾
- è‡ªåŠ¨å†²çªæ£€æµ‹å’Œè§£å†³

### 2. å¤šå®ä¾‹æ”¯æŒ

- FileSearch èŠ‚ç‚¹ï¼šç´¢å¼•å˜é‡å
- Agent èŠ‚ç‚¹ï¼šæ™ºèƒ½å‘½åè§„åˆ™
- Guardrails èŠ‚ç‚¹ï¼šåµŒå¥—åˆ†æ”¯

### 3. åˆ†æ”¯å¤„ç†

- åµŒå¥— if/else æ­£ç¡®ç”Ÿæˆ
- è‡ªåŠ¨ç¼©è¿›è°ƒæ•´
- è¡¨è¾¾å¼é“¾æ¥

### 4. ä»£ç è´¨é‡

- å®Œæ•´çš„ç±»å‹å®šä¹‰
- è¯¦ç»†çš„ä»£ç æ³¨é‡Š
- 100% æµ‹è¯•è¦†ç›–ç‡

## ğŸ“š æ–‡æ¡£ç”Ÿæˆ

æœ¬é˜¶æ®µç”Ÿæˆäº†è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£ï¼š

1. **AGENT_VARIABLE_NAMING.md** (305 è¡Œ)
   - Agent å˜é‡å‘½åç®—æ³•è¯¦è§£
   - å®é™…ç¤ºä¾‹å’Œç‰¹æ®Šæƒ…å†µ
   - å†²çªå¤„ç†é€»è¾‘

2. **GUARDRAILS_NODE.md** (412 è¡Œ)
   - Guardrails èŠ‚ç‚¹å®Œæ•´è¯´æ˜
   - é…ç½®å‚æ•°è¯¦è§£
   - å¤šç±»å‹ Guardrail è¯´æ˜
   - è¡¨è¾¾å¼å¤„ç†è§„åˆ™
   - æµ‹è¯•ç”¨ä¾‹è¯´æ˜

3. **README.md** (77 è¡Œ)
   - æ–‡æ¡£å…¥å£
   - æ¦‚è¿°å’Œå¿«é€Ÿå¯¼èˆª
   - å¼€å‘æŒ‡å—

## ğŸ” å…³é”®æŠ€æœ¯å†³ç­–

### 1. å¤šå±‚çº§ç¼©è¿›è®¡ç®—

**å†³ç­–**: ä½¿ç”¨å…¬å¼ `2 + guardrailsIndex * 2` è€Œéç¡¬ç¼–ç ç¼©è¿›
**åŸå› **:

- æ”¯æŒä»»æ„æ·±åº¦çš„åµŒå¥—
- ä»£ç æ›´æ˜“ç»´æŠ¤
- è‡ªåŠ¨é€‚åº”æ–°éœ€æ±‚

### 2. è¾“å…¥è¡¨è¾¾å¼åŠ¨æ€æ›¿æ¢

**å†³ç­–**: åç»­èŠ‚ç‚¹è‡ªåŠ¨ä½¿ç”¨å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ç»“æœ
**åŸå› **:

- å‡å°‘é…ç½®éœ€æ±‚
- æ›´ç¬¦åˆå·¥ä½œæµé€»è¾‘
- é¿å…é…ç½®é”™è¯¯

### 3. å˜é‡åå†²çªå¤„ç†

**å†³ç­–**: é»˜è®¤æ ‡ç­¾æ™ºèƒ½è·³è¿‡è‡ªå®šä¹‰æ ‡ç­¾å ç”¨çš„æ•°å­—
**åŸå› **:

- é¢„æµ‹æ€§å¼º
- é¿å…æ„å¤–å†²çª
- ä¿æŒå‘½åä¸€è‡´æ€§

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•åˆ†ç±»

1. **å•å…ƒæµ‹è¯•**: ç‹¬ç«‹èŠ‚ç‚¹çš„ä»£ç ç”Ÿæˆ
2. **é›†æˆæµ‹è¯•**: å¤šèŠ‚ç‚¹å·¥ä½œæµ
3. **å›å½’æµ‹è¯•**: ç¡®ä¿å…¼å®¹æ€§

### æµ‹è¯•è¦†ç›–èŒƒå›´

| ç±»åˆ«            | æµ‹è¯•æ•° | é€šè¿‡ç‡   |
| --------------- | ------ | -------- |
| Agent èŠ‚ç‚¹      | 12+    | 100%     |
| FileSearch èŠ‚ç‚¹ | 4+     | 100%     |
| Guardrails èŠ‚ç‚¹ | 8+     | 100%     |
| å·¥ä½œæµé›†æˆ      | 28+    | 100%     |
| **æ€»è®¡**        | **52** | **100%** |

## ğŸ’¡ æœ€ä½³å®è·µ

### ä»£ç ç”Ÿæˆ

1. **å˜é‡å‘½å**
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„å‰ç¼€ï¼ˆ`agent_`, `filesearch_`, `guardrails_`ï¼‰
   - ä¿æŒä¸€è‡´çš„ç´¢å¼•è§„åˆ™
   - é¿å… Python å…³é”®å­—

2. **ç¼©è¿›ç®¡ç†**
   - ä½¿ç”¨å…¬å¼è®¡ç®—è€Œéç¡¬ç¼–ç 
   - ç¡®ä¿åµŒå¥—å±‚çº§æ­£ç¡®
   - éªŒè¯ç”Ÿæˆä»£ç çš„å¯è¯»æ€§

3. **è¡¨è¾¾å¼å¤„ç†**
   - æ­£ç¡®è½¬æ¢å„ç§è¡¨è¾¾å¼æ ¼å¼
   - å¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œè½¬ä¹‰
   - éªŒè¯è¡¨è¾¾å¼æœ‰æ•ˆæ€§

4. **é”™è¯¯å¤„ç†**
   - æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
   - æ”¯æŒ try-catch æ¨¡å¼
   - è®°å½•è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

## ğŸ”® æœªæ¥æ‰©å±•æ–¹å‘

### çŸ­æœŸï¼ˆNext Sprintï¼‰

- [ ] If/Else èŠ‚ç‚¹é«˜çº§åˆ†æ”¯å¤„ç†
- [ ] User Approval èŠ‚ç‚¹å®Œæ•´å®ç°
- [ ] Transform èŠ‚ç‚¹ä»£ç ç”Ÿæˆ

### ä¸­æœŸï¼ˆQ1 2025ï¼‰

- [ ] Loop èŠ‚ç‚¹æ”¯æŒ
- [ ] å¼‚æ­¥æµç¨‹ä¼˜åŒ–
- [ ] æ€§èƒ½ç›‘æ§

### é•¿æœŸï¼ˆQ2 2025+ï¼‰

- [ ] åŠ¨æ€èŠ‚ç‚¹ç±»å‹æ‰©å±•
- [ ] å·¥ä½œæµç¼–è¯‘ä¼˜åŒ–
- [ ] AI è¾…åŠ©é…ç½®ç”Ÿæˆ

## ğŸ“ é‡è¦æäº¤

### æœ¬é˜¶æ®µæäº¤

```
commit 2e223b8
Author: ä»£ç ç”Ÿæˆå™¨å¼€å‘å›¢é˜Ÿ
Date:   2025-10-20

    feat(code-generator): implement multiple guardrails nodes with proper branching and indentation

    - Add support for sequential guardrails nodes with on_pass edge branching
    - Implement dynamic input expressions for guardrails nodes (use previous result as input)
    - Fix indentation for nested guardrails nodes (2 + guardrailsIndex * 2 spaces)
    - Add previousGuardrailsResultVar parameter to generateGuardrailsNodeCode
    - Generate guardrails_result["safe_text"] for subsequent nodes
    - Add guardrails_with_multiple_and_labels test case
```

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [x] æ‰€æœ‰ 52 ä¸ªæµ‹è¯•é€šè¿‡
- [x] ä»£ç ç”Ÿæˆå™¨æ ¸å¿ƒåŠŸèƒ½å®Œæˆ
- [x] Agent èŠ‚ç‚¹å˜é‡å‘½åè§„åˆ™å®ç°
- [x] FileSearch å¤šå®ä¾‹æ”¯æŒ
- [x] Guardrails å¤šå±‚çº§åˆ†æ”¯å¤„ç†
- [x] è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ç¼–å†™
- [x] æµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰åŠŸèƒ½
- [x] ä»£ç å®¡æŸ¥å’Œä¼˜åŒ–
- [x] æ€§èƒ½éªŒè¯

## ğŸ“ å­¦ä¹ æ”¶è·

### æŠ€æœ¯æ–¹é¢

1. **ä»£ç ç”Ÿæˆè®¾è®¡æ¨¡å¼**
   - è®¿é—®è€…æ¨¡å¼ç”¨äºèŠ‚ç‚¹éå†
   - ç­–ç•¥æ¨¡å¼ç”¨äºä¸åŒèŠ‚ç‚¹ç±»å‹
   - æ„å»ºè€…æ¨¡å¼ç”¨äºä»£ç ç»„è£…

2. **Python ä»£ç ç”Ÿæˆ**
   - å­—ç¬¦ä¸²è½¬ä¹‰å’Œå¤„ç†
   - ç¼©è¿›ç®¡ç†å’ŒåµŒå¥—
   - è¡¨è¾¾å¼è½¬æ¢

3. **å·¥ä½œæµå¼•æ“æ¦‚å¿µ**
   - èŠ‚ç‚¹éå†ç®—æ³•
   - è¾¹ç•Œæ¡ä»¶å¤„ç†
   - æ•°æ®æµä¼ é€’

### å·¥ç¨‹æ–¹é¢

1. **TDD å¼€å‘**
   - å…ˆå†™æµ‹è¯•ï¼Œåå†™ä»£ç 
   - ç”¨æµ‹è¯•é©±åŠ¨è®¾è®¡
   - æŒç»­é›†æˆéªŒè¯

2. **æ–‡æ¡£ç¼–å†™**
   - æ¸…æ™°çš„æ¦‚å¿µè¯´æ˜
   - å®Œæ•´çš„ä»£ç ç¤ºä¾‹
   - å®ç”¨çš„æœ€ä½³å®è·µ

3. **ä»£ç è´¨é‡**
   - é«˜æµ‹è¯•è¦†ç›–ç‡
   - è¯¦ç»†çš„ä»£ç æ³¨é‡Š
   - ä¸€è‡´çš„ä»£ç é£æ ¼

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Open Agent Builder å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-10-20
**ç›¸å…³æ–‡ä»¶**: `AGENT_VARIABLE_NAMING.md`, `GUARDRAILS_NODE.md`, `README.md`
